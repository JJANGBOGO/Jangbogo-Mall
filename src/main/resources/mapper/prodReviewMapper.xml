<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.jangbogo.mall.dao.ProdReviewMapper">
<!--한 상품의(prod_idx) 상품이름,상품후기 정보 모두 가져오기-->
    <select id="selectAll" parameterType="int" resultType="ProdReviewDto">
        SELECT r.*, p.NAME,p.resv_photo_upload_path
        FROM (SELECT * FROM PRODUCT) p, PROD_LATE r
        WHERE p.IDX = r.PROD_IDX = #{prod_idx}
        ORDER BY r.REG_TM desc;
    </select>
    
    <update id="update" parameterType="ProdReviewDto">
        update PROD_LATE
        set CTENT = #{ctent}, OPUB_YN = #{opub_yn}, USER_IDX = #{user_idx}, STATE_CD = 2 ,CHG_TM = now()
        where idx = #{idx};
    </update>

    <insert id="insert" parameterType="ProdReviewDto">
        insert into PROD_LATE (ORD_IDX, PROD_IDX, USER_IDX, CTENT, WRITER)
        values (#{ord_idx}, #{prod_idx}, #{user_idx}, #{ctent}, #{writer});
    </insert>

</mapper>